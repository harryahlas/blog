<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Harry Ahlas">
<meta name="description" content="People analytics, music, and audio engineering. Views are my own.">
<meta name="generator" content="Hugo 0.62.2" />
<title>Use R to add a Data Disclaimer to an Excel Report</title>
<link rel="shortcut icon" href="/images/favicon2.ico">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">



<link rel="stylesheet" href="/css/monosocialiconsfont.css">




<meta property="og:title" content="Use R to add a Data Disclaimer to an Excel Report" />
<meta property="og:description" content="I work with confidential and restricted data in a legal/regulatory environment. Data needs to be accurate and secure. A robust disclaimer can go a long way in helping meet those needs.
In this post we will use R to:
Wrangle data from the hrsample databaseCreate a basic human resources summary report in ExcelAdd a simple data disclaimer tab to our reportYou can find the R script here: https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/use-r-to-add-a-data-disclaimer-to-an-excel-report/" />
<meta property="article:published_time" content="2019-04-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-04-07T00:00:00+00:00" />


<meta itemprop="name" content="Use R to add a Data Disclaimer to an Excel Report">
<meta itemprop="description" content="I work with confidential and restricted data in a legal/regulatory environment. Data needs to be accurate and secure. A robust disclaimer can go a long way in helping meet those needs.
In this post we will use R to:
Wrangle data from the hrsample databaseCreate a basic human resources summary report in ExcelAdd a simple data disclaimer tab to our reportYou can find the R script here: https://github.">
<meta itemprop="datePublished" content="2019-04-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-04-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1657">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Use R to add a Data Disclaimer to an Excel Report"/>
<meta name="twitter:description" content="I work with confidential and restricted data in a legal/regulatory environment. Data needs to be accurate and secure. A robust disclaimer can go a long way in helping meet those needs.
In this post we will use R to:
Wrangle data from the hrsample databaseCreate a basic human resources summary report in ExcelAdd a simple data disclaimer tab to our reportYou can find the R script here: https://github."/>
<meta name="twitter:site" content="@https://www.twitter.com/harry_ahlas"/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='/'> <span class="arrow">←</span>Home</a>
	

	
 		<a href='/about/'>About</a>
  	

	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Use R to add a Data Disclaimer to an Excel Report</h1>
        <h2 class="subtitle"></h2>
        <h2 class="headline">
        April 7, 2019
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        


<p>I work with confidential and restricted data in a legal/regulatory environment. Data needs to be accurate and secure. A robust disclaimer can go a long way in helping meet those needs.</p>
<p>In this post we will use R to:</p>
<ul>
<li>Wrangle data from the <em>hrsample</em> database</li>
<li>Create a basic human resources summary report in Excel</li>
<li>Add a simple data disclaimer tab to our report</li>
</ul>
<p>You can find the R script here: <a href="https://github.com/harryahlas/sample-hr-database/blob/master/analysis/data_disclaimer_tab.R" class="uri">https://github.com/harryahlas/sample-hr-database/blob/master/analysis/data_disclaimer_tab.R</a>.</p>
<div id="ever-in-our-favor" class="section level3">
<h3>Ever in Our Favor</h3>
<p>My team often distributes our data in Excel format. If you are cringing, no worries, bear with me. Legal and regulatory reporting is often better left vanilla. Excel/PDF/csv etc reports are more suitable for this type of work than, say, a dynamic Tableau dashboard or Shiny app.</p>
<p>The good news is we can turn this archaic Excel reporting practice in our favor. We can leverage Excel’s ability to have multiple tabs in one workbook to create a data disclaimer. The disclaimer will accomplish two things:</p>
<ol style="list-style-type: decimal">
<li>Clearly explain to our client how, if at all, s/he can distribute our data.</li>
<li>Help the client understand the data, mitigating risk and reducing the chance of confusion.</li>
</ol>
<p>I can’t emphasize enough how critical it is to proactively clarify anything that might potentially confuse the client. The disclaimer tab is the perfect opportunity to do so. The disclaimer tab can go a long way in avoiding confusion and - as a result - save time and money down the line. We’ll see an example of this in a bit.</p>
</div>
<div id="the-data" class="section level3">
<h3>The Data</h3>
<p>For this report, we will use the <em>hrsample</em> database (more info <a href="http://harry.ahlas.com/2019/03/17/hrsample-database/index.html">here</a>), which can be installed with <code>devtools::install_github("harryahlas/hrsample")</code>. Let’s say a legal team at this imaginary company wants to know what the company’s job headcount and turnover looked like in 2009.</p>
<p>Let’s begin with the R script. First things first, let’s load packages, create a report name/number for tracking as well as an as of date:</p>
<pre class="r"><code>library(hrsample)
library(tidyverse)
library(scales)
library(lubridate)
library(openxlsx)

report_name &lt;- &quot;PA73405 - Attrition by Job 2009&quot;
as_of_date &lt;- Sys.Date()</code></pre>
<p>Next, let’s take a closer look at our data from <em>hrsample</em>. There are two key tables we are interested in here. We can use <code>deskjob_table</code> and <code>deskhistory_table</code> in conjunction to determine all the employees’ movement information.
<code>deskjob_table</code> - this data associates each desk/position to a specific job.</p>
<pre class="r"><code>knitr::kable(deskjob_table[sample(nrow(deskjob_table),5),])
|     | desk_id|job_name    |
|:----|-------:|:-----------|
|777  |     777|Salesperson |
|1039 |    1039|Analyst     |
|423  |     423|Salesperson |
|503  |     503|Salesperson |
|1123 |    1123|Developer   |</code></pre>
<p><code>deskhistory_table</code> - this data captures the start and end dates for each employee’s job. It also captures whether the job resulted in a termination and if the job came as the result of a promotion.</p>
<pre class="r"><code>knitr::kable(deskhistory_table[sample(nrow(deskhistory_table),5),])
|      | employee_num| desk_id|desk_id_start_date |desk_id_end_date | termination_flag| promotion_flag|
|:-----|------------:|-------:|:------------------|:----------------|----------------:|--------------:|
|687   |        27083|     687|1999-01-01         |2000-05-11       |                0|              0|
|10015 |        22657|     677|2018-12-14         |2999-01-01       |                1|              1|
|1327  |        36399|     888|2000-03-17         |2002-10-06       |                1|              1|
|6431  |        18508|    1069|2011-06-20         |2012-12-19       |                0|              0|
|4962  |        24300|     424|2008-02-23         |2013-05-17       |                1|              0|</code></pre>
<p>You’ll notice both tables share a variable <code>desk_id.</code> You can think of <code>desk_id</code> as the employee’s unique desk number. The <code>desk_id_start_date</code> and <code>desk_id_end_date</code> variables refer to the dates the employee was at that “desk”. If the employee switched to a new job somewhere else in the company they would likely switch to a new <code>desk_id</code>. The <code>desk_id</code> is a critical key: from <code>desk_id</code> we can determine what job, location, manager, line of business, etc. belongs to the employee assigned to that <code>desk_id.</code></p>
</div>
<div id="summarize-data-with-tidyverse" class="section level2">
<h2>Summarize Data with Tidyverse</h2>
<p>Now that we have the raw data, let’s use some standard <em>dplyr/tidyr</em> functions to join the two datasets and create a simple data frame that summarizes turnover and headcount by job. First, we will create a new object called <em>hcto_summary</em> (headcount/turnover summary) by joining our two tables. The default join will be on <em>desk_id</em>.</p>
<pre class="r"><code>hcto_summary &lt;- deskhistory_table %&gt;% 
  left_join(deskjob_table) %&gt;%</code></pre>
<p>Next, we’ll filter for all rows that have data for 2009.</p>
<pre class="r"><code>  filter(desk_id_start_date &lt;= as.Date(&quot;2009-12-31&quot;),
         desk_id_end_date &gt;= as.Date(&quot;2009-01-01&quot;)) %&gt;%</code></pre>
<p>Some employees will have multiple jobs in 2009. Since we only want to count each employee once, let’s take their most recent job for this report. We have to account for the fact that some employees would have switched jobs in 2009. These employees would have multiple entries during that year, probably for different desk_ids. This is something we will call out on our disclaimer tab later on in order to avoid confusion down the line.</p>
<p>In order to count the most recent job for each employee who was active in 2009, we can sort the data with the most recent <code>desk_id_end_date</code> and then <code>group_by(employee_num) %&gt;% filter(row_number() == 1)</code> in order to select the most recent of those jobs. This is a nifty trick I use a lot, and we will be sure to document it in the disclaimer.</p>
<pre class="r"><code>  arrange(desc(desk_id_end_date)) %&gt;% 
  group_by(employee_num) %&gt;% 
  filter(row_number() == 1) %&gt;% 
  ungroup() %&gt;%</code></pre>
<p>Next, we’ll clean up some of the variables and names to make the data easier for the end user to digest. Here we will also calculate our key metric: if an employee’s last day in a desk (<code>desk_id_end_date</code>) was in 2009 and they terminated, then they will be flagged as a termination.</p>
<pre class="r"><code>  mutate(year = &quot;2009&quot;,
         termination_flag = if_else(termination_flag == 1 &amp; year(desk_id_end_date) == 2009, 
                                    &quot;Terminated&quot;, 
                                    &quot;DidNotTerminate&quot;)) %&gt;% </code></pre>
<p>The last piece is some wrangling, starting with a count of jobs separating out terminations. The spread function will pivot the data so there is a column for <code>Terminated</code> and a column for <code>DidNotTerminate</code>. We’ll also calculate total <code>Headcount</code> and <code>TerminationRate</code> columns.</p>
<pre class="r"><code>  count(job_name, termination_flag) %&gt;% 
  spread(termination_flag, n, fill = 0) %&gt;% 
  mutate(Headcount =  Terminated + DidNotTerminate,
         TerminationRate = percent(Terminated / Headcount)) %&gt;% 
  arrange(desc(Terminated / Headcount))</code></pre>
<p>Please note <code>spread</code> will be replaced with <code>pivot_wide</code> in the near future!</p>
<p>Here is all the code together. I love <em>tidyverse</em>.</p>
<pre class="r"><code>hcto_summary &lt;- deskhistory_table %&gt;% 
  left_join(deskjob_table) %&gt;% 
  filter(desk_id_start_date &lt;= as.Date(&quot;2009-12-31&quot;),
         desk_id_end_date &gt;= as.Date(&quot;2009-01-01&quot;)) %&gt;% 
  arrange(desc(desk_id_end_date)) %&gt;% 
  group_by(employee_num) %&gt;% 
  filter(row_number() == 1) %&gt;% 
  ungroup() %&gt;% 
  mutate(year = &quot;2009&quot;,
         termination_flag = if_else(termination_flag == 1 &amp; year(desk_id_end_date) == 2009, 
                                    &quot;Terminated&quot;, 
                                    &quot;DidNotTerminate&quot;)) %&gt;% 
  count(year, job_name, termination_flag) %&gt;% 
  spread(termination_flag, n, fill = 0) %&gt;% 
  mutate(Headcount =  Terminated + DidNotTerminate,
         TerminationRate = percent(Terminated / Headcount)) %&gt;% 
  arrange(desc(Terminated / Headcount))</code></pre>
<p>Here is the output data that we want to send to the clients:</p>
<pre class="r"><code>knitr::kable(hcto_summary)
|year |job_name          | DidNotTerminate| Terminated| Headcount|TerminationRate |
|:----|:-----------------|---------------:|----------:|---------:|:---------------|
|2009 |Paralegal         |              18|          5|        23|21.7%           |
|2009 |Regional Leader   |             136|         27|       163|16.6%           |
|2009 |Salesperson       |             522|         94|       616|15.3%           |
|2009 |Consultant        |              85|         14|        99|14.1%           |
|2009 |Department Leader |              33|          5|        38|13.2%           |
|2009 |Attorney          |              41|          6|        47|12.8%           |
|2009 |Project Manager   |              70|         10|        80|12.5%           |
|2009 |Product Manager   |              79|         10|        89|11.2%           |
|2009 |Analyst           |              72|          9|        81|11.1%           |
|2009 |Developer         |             115|         13|       128|10.2%           |
|2009 |Business Leader   |               7|          0|         7|0.0%            |
|2009 |CEO               |               1|          0|         1|0.0%            |</code></pre>
<div id="data-disclaimer-tab" class="section level3">
<h3>Data Disclaimer Tab</h3>
<p>With the retrieval and manipulation behind us, the data is almost ready to export. We are now at the data disclaimer piece. Before continuing, I need to mention this disclaimer is very basic and for demonstration purposes only. <em>Always consult your legal team for approval of external disclaimer verbiage</em>.</p>
<p>This disclaimer will include distribution information as well as information about how the data was pulled. This is our shot to clarify the way we are counting employees (only count the most recent 2009 job). The client typically doesn’t have time to think about these types of details, so making this clarification now will prepare your client for questions and potentially save you from urgent follow up scrambles that no one enjoys.</p>
<p>I have packaged this example’s verbiage into a data frame:</p>
<pre class="r"><code>disclaimer_info &lt;- data.frame(Information = 
  c(&quot;Source: hrsample&quot;,
    paste(&quot;Data as of&quot;, as_of_date, &quot;.&quot;),
    &quot;Data includes all employees rolling up to CEO Danica Hammel who were active at any point from Jan 1, 2009 through December 31, 2009.&quot;,
    &quot;If the employee had multiple jobs during 2009, only the most recent job is counted.&quot;,
    &quot;Data is confidential and should be shared on a need to know basis only.&quot;,
    &quot;Do not distribute externally.&quot;))  </code></pre>
<p>Note that the text is enclosed in a concatenation <code>c("xxx", "yyy", "zzz")</code>. The <em>openxlsx</em> package will look for the commas between quotations and determine that words that come after the commas go into a new row in Excel.</p>
</div>
<div id="export-to-excel" class="section level3">
<h3>Export to Excel</h3>
<p>I tend to favor the <em>openxlsx</em> package over others for exporting to Excel. It seems less error prone because it is not dependent on Java. With that, let’s start by creating a new Excel workbook object <code>wb</code> and adding two tabs: the first for the data summary and the second for the disclaimer.</p>
<pre class="r"><code>wb &lt;- createWorkbook()
addWorksheet(wb, report_name)
addWorksheet(wb, &quot;Data Disclaimer&quot;)</code></pre>
<p>Now we can write our summary and disclaimer data frames to each sheet. The numbers 1 and 2 below are the sheet numbers.</p>
<pre class="r"><code>writeDataTable(wb, 1, hcto_summary)
writeDataTable(wb, 2, disclaimer_info)</code></pre>
<p>Next, let’s add just a touch of formatting to sheet #2, our disclaimer tab. Let’s wrap the items in the first column and set the column width of the first row to 50 pixels.</p>
<pre class="r"><code>addStyle(wb, 2, style = createStyle(wrapText = TRUE), rows = 1:7, cols = 1)
setColWidths(wb, 2, 1, widths = 50)</code></pre>
<p>Last, we’ll save the workbook with the report name and date and we are done!</p>
<pre class="r"><code>saveWorkbook(wb, paste0(report_name, as_of_date, &quot;.xlsx&quot;), TRUE)</code></pre>
</div>
<div id="final-thought---why-automate" class="section level3">
<h3>Final Thought - Why Automate?</h3>
<p>For a one time report this may seem like a lot of work to add one tab with only 7 rows of text. Why not just input the text directly into Excel?</p>
<p>I would agree this is overkill for one report. However, there is a good chance that this code can be reused later. It could be packaged into a function as well, depending on your need.</p>
<p>The value really rears its head when you start producing multiple reports - super handy! That is something I will be tackling on a future post and look forward to sharing with you.</p>
<p>Thanks for reading - I would appreciate any feedback. <a href="https://github.com/harryahlas/sample-hr-database/blob/master/analysis/data_disclaimer_tab.R">Here</a> is a link to the code.</p>
</div>
</div>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    <a href="https://twitter.com/harry_ahlas">
    <img class="avatar" src="/images/avatar.png">
    <div>
        <span class="dark">Harry Ahlas</span>
        <span>People Analytics Manager</span>
    </div>
    </a>
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=%2fpost%2fuse-r-to-add-a-data-disclaimer-to-an-excel-report%2f - Use%20R%20to%20add%20a%20Data%20Disclaimer%20to%20an%20Excel%20Report by @harry_ahlas"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "spf13" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/post/efficient-filesearching-with-r/">Efficient Filesearching with R<aside class="dates">Nov 24 2019</aside></a>
        </li>
    
        <li>
            <a href="/post/basic-etl-with-r-and-sql/">Basic ETL with R and SQL<aside class="dates">Aug 11 2019</aside></a>
        </li>
    
        <li>
            <a href="/post/upload-an-entire-directory-through-sftp-with-r/">Upload an Entire Directory through SFTP with R<aside class="dates">Jul 28 2019</aside></a>
        </li>
    
        <li>
            <a href="/post/multi-condition-data-retrieval/">Multi-Condition Data Retrieval<aside class="dates">Jul 21 2019</aside></a>
        </li>
    
        <li>
            <a href="/post/automated-excel-report-generation-with-r/">Automated Excel Report Generation with R<aside class="dates">Apr 28 2019</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    
    <a class="symbol" href="https://www.github.com/harryahlas">
        circlegithub
    </a>
    
    <a class="symbol" href="https://www.twitter.com/harry_ahlas">
        circletwitterbird
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2020 Harry Ahlas
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>





</body>
</html>
